# Задание 3 — Гибридная обработка массива (CPU + GPU)

## 1. Цель задания

Цель задания — реализовать **гибридную обработку массива**, при которой вычисления выполняются **одновременно на CPU и GPU**.

По условию требуется:

1. Разделить массив на две части:
   - первая половина обрабатывается на CPU;
   - вторая половина обрабатывается на GPU.
2. Реализовать гибридное приложение, в котором CPU и GPU работают параллельно.
3. Замерить **общее время выполнения гибридной обработки**.

Задание демонстрирует принципы гибридных вычислений и совместное использование CPU и GPU в одном приложении.



## 2. Общая идея решения

Основная идея решения заключается в следующем:

- массив данных делится на две равные части;
- CPU и GPU выполняют обработку **не последовательно, а одновременно**;
- после завершения вычислений результаты объединяются в одном массиве;
- измеряется суммарное время выполнения всей гибридной обработки.

Для параллельного выполнения CPU- и GPU-частей используется **OpenMP**, а для вычислений на GPU — **CUDA**.



## 3. Подготовка данных

В программе создаётся массив размером `N = 1 000 000`.

Дополнительно вычисляется значение `half = N / 2`, которое определяет границу между частями массива:

- элементы с индексами `0 … half-1` обрабатываются на CPU;
- элементы с индексами `half … N-1` обрабатываются на GPU.

Массив инициализируется значениями индексов, что упрощает проверку корректности результата после обработки.



## 4. Разделение работы между CPU и GPU

### CPU-часть

CPU обрабатывает **первую половину массива**.  
Для каждого элемента выполняется операция умножения на 2.

Эта часть кода выполняется внутри отдельной OpenMP-секции и работает независимо от GPU.



### GPU-часть

GPU обрабатывает **вторую половину массива** с помощью CUDA-ядра.

Каждый CUDA-поток:
- вычисляет свой локальный индекс;
- преобразует его в глобальный индекс с учётом смещения `offset = half`;
- умножает соответствующий элемент массива на 2.

Таким образом, GPU затрагивает только вторую половину массива.



## 5. Параллельное выполнение CPU и GPU

Ключевой момент задания — **одновременная работа CPU и GPU**.

Это реализовано с помощью директивы OpenMP:

`#pragma omp parallel sections`

Внутри неё:
- одна секция запускает обработку первой половины массива на CPU;
- вторая секция запускает CUDA-ядро для второй половины массива.

CPU и GPU начинают вычисления практически одновременно, что и делает обработку гибридной.



## 6. Работа с памятью GPU

Для упрощения логики:

- весь массив предварительно копируется на GPU;
- GPU изменяет только вторую половину массива;
- обратно на CPU копируется только обработанная GPU-часть массива.

Такой подход уменьшает количество операций копирования и делает код более наглядным.



## 7. Замер времени выполнения

Для измерения общего времени выполнения используется `std::chrono`.

Отсчёт времени начинается:
- до запуска параллельных CPU- и GPU-секций,

и заканчивается:
- после завершения вычислений и копирования данных с GPU.

Таким образом измеряется **полное время гибридной обработки**, включающее вычисления на CPU, вычисления на GPU и синхронизацию.



## 8. Проверка корректности

После завершения вычислений выполняется проверка корректности результата.

Для каждого элемента массива проверяется, что его значение равно удвоенному исходному индексу.  
Если все элементы удовлетворяют этому условию, обработка считается выполненной корректно.



## 9. Вывод программы

Программа выводит:

- размер обрабатываемого массива;
- общее время выполнения гибридной обработки (CPU + GPU);
- результат проверки корректности вычислений.

