# Практическая работа №7: Редукция и сканирование на GPU
## Цель работы
Изучение и реализация параллельных алгоритмов редукции и сканирования
(префиксной суммы) на GPU с использованием CUDA. Исследование
производительности этих алгоритмов и их оптимизация.
## Задачи
1. Реализовать алгоритм редукции для вычисления суммы элементов
массива на GPU.
2. Реализовать алгоритм сканирования (префиксной суммы) на GPU.
3. Провести анализ производительности реализованных алгоритмов.
4. Оптимизировать код с использованием различных типов памяти CUDA.
## Теоретическая часть
### 1. Редукция
Редукция — это операция, которая сводит множество элементов к одному
значению (например, сумма, минимум, максимум). На GPU редукция
выполняется с использованием иерархии потоков и блоков.
### 2. Сканирование (префиксная сумма)
Сканирование — это операция, которая вычисляет накопленный результат для
каждого элемента массива. Например, для массива [1, 2, 3, 4] префиксная
сумма будет [1, 3, 6, 10].
### 3. Типы памяти в CUDA
- **Глобальная память:** Основная память GPU, доступная всем потокам.
- **Разделяемая память:** Быстрая память, доступная только потокам
внутри одного блока.
- **Локальная память:** Память, выделенная для каждого потока.
## Практическая часть
### Задание 1: Реализация редукции
1. Напишите ядро CUDA для выполнения редукции (суммирования элементов массива).
2. Используйте разделяемую память для оптимизации доступа к данным.
3. Проверьте корректность работы на тестовом массиве.
### Задание 2: Реализация префиксной суммы
1. Напишите ядро CUDA для выполнения префиксной суммы.
2. Используйте разделяемую память для оптимизации доступа к данным.
3. Проверьте корректность работы на тестовом массиве.
### Задание 3: Анализ производительности
1. Замерьте время выполнения редукции и сканирования для массивов разного размера.
2. Сравните производительность с CPU-реализацией.
3. Проведите оптимизацию кода, используя различные типы памяти CUDA.

## Контрольные вопросы
### 1. В чём разница между редукцией и сканированием?
**Редукция** — это операция, которая сводит массив данных к одному значению, например сумме, минимуму или максимуму элементов.
Результатом редукции является один итоговый элемент.

**Сканирование** (prefix sum) — это операция, при которой для каждого элемента массива вычисляется накопленный результат от начала массива до текущего элемента.
Результатом сканирования является массив той же длины, где каждый элемент зависит от предыдущих.
### 2. Какие типы памяти CUDA используются для оптимизации редукции и сканирования?
Для оптимизации используются следующие типы памяти CUDA:

- Глобальная память (global memory) — основное хранилище данных; имеет высокую задержку, поэтому её использование стараются минимизировать.

- Разделяемая память (shared memory) — быстрая память внутри блока потоков; активно используется для параллельной редукции и сканирования.

- Регистры — самая быстрая память, используется для локальных переменных внутри потоков.

- Константная память (constant memory) — может применяться для хранения неизменяемых параметров алгоритма (например, размеров).

Наибольший вклад в ускорение дают shared memory и регистры, так как они существенно уменьшают число обращений к глобальной памяти.

### 3. Как можно оптимизировать префиксную сумму на GPU?
Префиксную сумму на GPU можно оптимизировать следующими способами:

- Использовать алгоритм Blelloch или аналогичные параллельные схемы вместо наивного Hillis–Steele.

- Выполнять основные вычисления в shared memory, чтобы снизить задержки доступа.

- Разбивать массив на блоки и выполнять локальное сканирование внутри блока.

- Применять иерархический подход: сначала сканировать блоки, затем добавлять оффсеты блоков.

- Минимизировать количество запусков kernel и обращений к глобальной памяти.

### 4. Приведите пример задачи, где применяется сканирование.
Сканирование применяется во многих практических задачах, например:

- **Сортировка (Radix Sort)** - для вычисления позиций элементов.

- **Фильтрация данных** - определение новых индексов элементов, прошедших условие.

- **Построение гистограмм** - накопление частот.

- **Обработка графов** - формирование CSR-структур.

- **Параллельная обработка массивов** - вычисление кумулятивных сумм, вероятностей и распределений.
